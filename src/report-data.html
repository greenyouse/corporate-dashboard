<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="report-data">

  <script>
   Polymer({
     is: 'report-data',

     properties: {
       // for csv
       headers: {
         type: Array,
         notify: true
       },

       lines: {
         type: Array,
         notify: true
       },

       // for json
       data: {
         type: Array,
         notify: true
       },

       fileName: {
         type: String
       }
     },

     observers: [
       '_fetchData(fileName)'
     ],

     _parseCSV: function (resp) {
       var _this1 = this;

       resp.text().then(function (csv) {
         var rows = csv.split("\n");
         // last row is a "" line, removing it here
         rows.splice(-1)

         _this1.headers = rows.splice(0,1)[0].split(",");

         _this1.lines = rows.map(function (row) {
           return row.split(",");
         });
       });
     },

     _parseJSON: function (resp) {
       var _this1 = this;

       resp.json().then(function (json) {
         _this1.data = json;
       });
     },

     _fetchData: function(fileName) {
       var csvReg = /\.csv$/i,
           jsonReg = /\.json$/i,
           _this2 = this;

       fetch (fileName).then(function (resp) {

         switch (true) {
           case csvReg.test(fileName):
             _this2._parseCSV(resp);
             break;

           case jsonReg.test(fileName):
             _this2._parseJSON(resp);
             break;

           default:
             console.log("file format for " + fileName + " not supported");
         }
       }, function (e) {
         console.log("file fetching error ", e);
       });
     }

   });
  </script>

</dom-module>
